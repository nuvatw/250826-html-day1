<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- è¨­å®šé é¢ç·¨ç¢¼ç‚º UTF-8ï¼Œæ”¯æ´ä¸­æ–‡ -->
    <meta charset="UTF-8">
    <!-- è®“é é¢åœ¨æ‰‹æ©Ÿä¸Šæ­£ç¢ºé¡¯ç¤º -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- é é¢æ¨™é¡Œï¼Œæœƒé¡¯ç¤ºåœ¨ç€è¦½å™¨åˆ†é ä¸Š -->
    <title>Google Sheets æ•¸æ“šé¡¯ç¤º</title>
    
    <!-- CSS æ¨£å¼è¨­å®š -->
    <style>
        /* è¨­å®šæ•´å€‹é é¢çš„åŸºæœ¬æ¨£å¼ */
        body {
            font-family: Arial, sans-serif;  /* å­—é«”è¨­å®š */
            margin: 20px;                    /* é é¢é‚Šè· */
            background-color: #f5f5f5;       /* èƒŒæ™¯é¡è‰² */
        }
        
        /* æ¨™é¡Œæ¨£å¼ */
        h1 {
            color: #333;                     /* æ–‡å­—é¡è‰² */
            text-align: center;              /* æ–‡å­—ç½®ä¸­ */
        }
        
        /* æ•¸æ“šå®¹å™¨çš„æ¨£å¼ */
        .data-container {
            background-color: white;         /* èƒŒæ™¯ç™½è‰² */
            padding: 20px;                   /* å…§é‚Šè· */
            border-radius: 8px;              /* åœ“è§’é‚Šæ¡† */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* é™°å½±æ•ˆæœ */
            max-width: 600px;                /* æœ€å¤§å¯¬åº¦ */
            margin: 0 auto;                  /* æ°´å¹³ç½®ä¸­ */
        }
        
        /* æ•¸å­—é¡¯ç¤ºå€åŸŸçš„æ¨£å¼ */
        .number-display {
            font-size: 48px;                /* å¤§å­—é«” */
            font-weight: bold;               /* ç²—é«” */
            color: #007bff;                  /* è—è‰² */
            text-align: center;              /* ç½®ä¸­ */
            margin: 20px 0;                  /* ä¸Šä¸‹é–“è· */
        }
        
        /* è¼‰å…¥ç‹€æ…‹çš„æ¨£å¼ */
        .loading {
            text-align: center;              /* æ–‡å­—ç½®ä¸­ */
            color: #666;                     /* ç°è‰²æ–‡å­— */
            font-style: italic;              /* æ–œé«” */
        }
        
        /* éŒ¯èª¤è¨Šæ¯çš„æ¨£å¼ */
        .error {
            color: #dc3545;                  /* ç´…è‰²æ–‡å­— */
            text-align: center;              /* æ–‡å­—ç½®ä¸­ */
            background-color: #f8d7da;       /* æ·¡ç´…è‰²èƒŒæ™¯ */
            padding: 10px;                   /* å…§é‚Šè· */
            border-radius: 4px;              /* åœ“è§’ */
        }
        
        /* æ›´æ–°æ™‚é–“é¡¯ç¤ºçš„æ¨£å¼ */
        .last-update {
            font-size: 12px;                /* å°å­—é«” */
            color: #999;                     /* æ·¡ç°è‰² */
            text-align: center;              /* ç½®ä¸­ */
            margin-top: 10px;                /* ä¸Šé‚Šè· */
        }
        
        /* é‡æ–°æ•´ç†æŒ‰éˆ•çš„æ¨£å¼ */
        .refresh-button {
            background-color: #007bff;       /* è—è‰²èƒŒæ™¯ */
            color: white;                    /* ç™½è‰²æ–‡å­— */
            border: none;                    /* ç„¡é‚Šæ¡† */
            padding: 10px 20px;              /* å…§é‚Šè· */
            border-radius: 5px;              /* åœ“è§’ */
            cursor: pointer;                 /* æ»‘é¼ æŒ‡æ¨™è®Šæˆæ‰‹å‹ */
            font-size: 14px;                 /* å­—é«”å¤§å° */
            transition: background-color 0.3s; /* èƒŒæ™¯è‰²è®ŠåŒ–å‹•ç•« */
        }
        
        /* æŒ‰éˆ•æ»‘é¼ æ‡¸åœæ•ˆæœ */
        .refresh-button:hover {
            background-color: #0056b3;       /* æ·±è—è‰²èƒŒæ™¯ */
        }
        
        /* æŒ‰éˆ•æŒ‰ä¸‹æ™‚çš„æ•ˆæœ */
        .refresh-button:active {
            transform: scale(0.98);          /* ç¨å¾®ç¸®å° */
        }
        
        /* æŒ‰éˆ•è¼‰å…¥ä¸­çš„æ¨£å¼ */
        .refresh-button:disabled {
            background-color: #6c757d;       /* ç°è‰²èƒŒæ™¯ */
            cursor: not-allowed;             /* ç¦ç”¨æŒ‡æ¨™ */
        }
    </style>
</head>
<body>
    <!-- é é¢æ¨™é¡Œ -->
    <h1>Google Sheets æ•¸æ“šé¡¯ç¤º</h1>
    
    <!-- æ•¸æ“šé¡¯ç¤ºå®¹å™¨ -->
    <div class="data-container">
        <!-- é€™è£¡æœƒé¡¯ç¤ºå¾ Google Sheets è®€å–çš„æ•¸å­— -->
        <div id="numberDisplay" class="loading">è¼‰å…¥ä¸­...</div>
        <!-- é¡¯ç¤ºæœ€å¾Œæ›´æ–°æ™‚é–“ -->
        <div id="lastUpdate" class="last-update"></div>
        <!-- é‡æ–°æ•´ç†æŒ‰éˆ• -->
        <div style="text-align: center; margin-top: 15px;">
            <button id="refreshButton" class="refresh-button">ğŸ”„ é‡æ–°æ•´ç†</button>
        </div>
    </div>

    <!-- JavaScript ç¨‹å¼ç¢¼ -->
    <script>
        // ä½ çš„ Google Sheets CSV é€£çµ
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQHDxdW5EX7B356k6lVFMOxsKqe-R73pre7tInKZmYOBpitUEoICGTckK7Coc_PbuWK89EzHEP3kmXZ/pub?gid=0&single=true&output=csv';
        
        // å–å¾— HTML å…ƒç´ çš„åƒè€ƒï¼Œæ–¹ä¾¿å¾ŒçºŒæ“ä½œ
        const numberDisplay = document.getElementById('numberDisplay');
        const lastUpdate = document.getElementById('lastUpdate');
        const refreshButton = document.getElementById('refreshButton');
        
        // å¾ Google Sheets è®€å–æ•¸æ“šçš„å‡½æ•¸
        async function fetchData() {
            try {
                // ç¦ç”¨é‡æ–°æ•´ç†æŒ‰éˆ•ï¼Œé¿å…é‡è¤‡è«‹æ±‚
                refreshButton.disabled = true;
                refreshButton.textContent = 'ğŸ”„ è¼‰å…¥ä¸­...';
                
                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                numberDisplay.innerHTML = '<div class="loading">è¼‰å…¥ä¸­...</div>';
                
                // ä½¿ç”¨ fetch API å‘ Google Sheets ç™¼é€è«‹æ±‚
                // åŠ ä¸Šéš¨æ©Ÿæ•¸å’Œæ™‚é–“æˆ³è¨˜ï¼Œå¼·åˆ¶é¿å…å¿«å–
                const timestamp = new Date().getTime();
                const randomNum = Math.random();
                const response = await fetch(CSV_URL + '&t=' + timestamp + '&r=' + randomNum, {
                    // åŠ ä¸Šé€™äº› headers ä¾†é¿å…å¿«å–å•é¡Œ
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });
                
                // æª¢æŸ¥è«‹æ±‚æ˜¯å¦æˆåŠŸ
                if (!response.ok) {
                    throw new Error(`ç¶²è·¯è«‹æ±‚å¤±æ•—: ${response.status}`);
                }
                
                // å–å¾— CSV æ–‡å­—å…§å®¹
                const csvText = await response.text();
                console.log('æ”¶åˆ°çš„ CSV è³‡æ–™:', csvText); // é™¤éŒ¯ç”¨ï¼Œåœ¨é–‹ç™¼è€…å·¥å…·ä¸­å¯ä»¥çœ‹åˆ°
                
                // è§£æ CSV å…§å®¹
                const data = parseCSV(csvText);
                console.log('è§£æå¾Œçš„è³‡æ–™:', data); // é™¤éŒ¯ç”¨
                
                // å¾è§£æå¾Œçš„è³‡æ–™ä¸­æ‰¾åˆ° num æ¬„ä½çš„å€¼
                if (data && data.length > 1) {
                    // å°‹æ‰¾åŒ…å« num è³‡æ–™çš„è¡Œ
                    let numValue = null;
                    for (let i = 1; i < data.length; i++) {
                        if (data[i].num !== undefined && data[i].num !== '') {
                            numValue = data[i].num;
                            break;
                        }
                    }
                    
                    if (numValue !== null) {
                        // é¡¯ç¤ºæ•¸å­—
                        numberDisplay.innerHTML = `<div class="number-display">${numValue}</div>`;
                    } else {
                        // å¦‚æœæ‰¾ä¸åˆ°æ•¸æ“šï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                        numberDisplay.innerHTML = '<div class="error">æ‰¾ä¸åˆ° num æ¬„ä½çš„è³‡æ–™</div>';
                    }
                } else {
                    // å¦‚æœè³‡æ–™æ ¼å¼ä¸å°ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                    numberDisplay.innerHTML = '<div class="error">è³‡æ–™æ ¼å¼éŒ¯èª¤æˆ–æ˜¯ç©ºçš„</div>';
                }
                
                // é¡¯ç¤ºæœ€å¾Œæ›´æ–°æ™‚é–“
                const now = new Date();
                lastUpdate.textContent = `æœ€å¾Œæ›´æ–°: ${now.toLocaleString('zh-TW')}`;
                
            } catch (error) {
                // å¦‚æœç™¼ç”ŸéŒ¯èª¤ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                console.error('è®€å–æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                numberDisplay.innerHTML = '<div class="error">è¼‰å…¥å¤±æ•—: ' + error.message + '</div>';
            } finally {
                // é‡æ–°å•Ÿç”¨æŒ‰éˆ•
                refreshButton.disabled = false;
                refreshButton.textContent = 'ğŸ”„ é‡æ–°æ•´ç†';
            }
        }
        
        // ç°¡å–®çš„ CSV è§£æå‡½æ•¸
        function parseCSV(csvText) {
            // å°‡ CSV æ–‡å­—æŒ‰è¡Œåˆ†å‰²
            const lines = csvText.trim().split('\n');
            
            // å–å¾—æ¨™é¡Œè¡Œï¼ˆç¬¬ä¸€è¡Œï¼‰
            const headers = lines[0].split(',').map(header => header.replace(/"/g, '').trim());
            
            // è§£ææ¯ä¸€è¡Œæ•¸æ“š
            const result = [];
            for (let i = 0; i < lines.length; i++) {
                const values = lines[i].split(',').map(value => value.replace(/"/g, '').trim());
                const row = {};
                
                // å°‡æ¯å€‹å€¼å°æ‡‰åˆ°ç›¸æ‡‰çš„æ¨™é¡Œ
                headers.forEach((header, index) => {
                    row[header] = values[index];
                });
                
                result.push(row);
            }
            
            return result;
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œç«‹å³è®€å–æ•¸æ“š
        fetchData();
        
        // è¨­å®šè‡ªå‹•æ›´æ–°ï¼Œæ¯60ç§’æª¢æŸ¥ä¸€æ¬¡æ–°æ•¸æ“šï¼ˆå¢åŠ åˆ°60ç§’é¿å…å¤ªé »ç¹ï¼‰
        setInterval(fetchData, 60000);
        
        // é‡æ–°æ•´ç†æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶
        refreshButton.addEventListener('click', function() {
            console.log('ä½¿ç”¨è€…é»æ“Šé‡æ–°æ•´ç†æŒ‰éˆ•');
            fetchData();
        });
        
        // ä¹Ÿå¯ä»¥è®“ä½¿ç”¨è€…é»æ“Šæ•¸å­—ä¾†æ‰‹å‹•æ›´æ–°ï¼ˆä¿ç•™åŸåŠŸèƒ½ï¼‰
        numberDisplay.addEventListener('click', function() {
            console.log('ä½¿ç”¨è€…é»æ“Šæ•¸å­—å€åŸŸ');
            fetchData();
        });
    </script>
</body>
</html>